---
import '../styles/global.css';
import { siteConfig } from '../data/site';
import Header from '../components/layout/Header.astro';
import Footer from '../components/layout/Footer.astro';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
  canonicalURL?: string;
  breadcrumbs?: Array<{ name: string; url: string }>;
}

const {
  title = siteConfig.title,
  description = siteConfig.description,
  image = `${siteConfig.url}/me.jpg`,
  type = 'website',
  canonicalURL = new URL(Astro.url.pathname, siteConfig.url).href,
  breadcrumbs
} = Astro.props;

const structuredData = {
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "David Garibay",
  "url": siteConfig.url,
  "image": `${siteConfig.url}/me.jpg`,
  "jobTitle": "Senior Software Development Engineer in Test (SDET)",
  "description": description,
  "address": {
    "@type": "PostalAddress",
    "addressLocality": siteConfig.location.city,
    "addressRegion": siteConfig.location.region,
    "addressCountry": siteConfig.location.country
  },
  "workLocation": {
    "@type": "Place",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": siteConfig.location.city,
      "addressRegion": siteConfig.location.region,
      "addressCountry": siteConfig.location.country
    }
  },
  "sameAs": [
    siteConfig.social.linkedin,
    siteConfig.social.github,
    siteConfig.social.youtube
  ],
  "knowsAbout": [
    "Agentic AI",
    "Claude Code",
    "AI Agents",
    "Model Context Protocol (MCP)",
    "Context Engineering",
    "LangGraph",
    "Test Automation",
    "Playwright",
    "TypeScript",
    "React",
    "FastAPI",
    "Python",
    "Proxmox",
    "Infrastructure as Code",
    "Docker",
    "Software Testing"
  ]
};

const breadcrumbSchema = breadcrumbs ? {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbs.map((crumb, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "name": crumb.name,
    "item": crumb.url
  }))
} : null;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta name="author" content="David Garibay" />
    <meta name="keywords" content="David Garibay, Agentic AI, Claude Code, AI Agents, MCP, Model Context Protocol, Context Engineering, LangGraph, SDET, Test Automation, Playwright, TypeScript, React, FastAPI, Python, Proxmox, Homelab, Infrastructure as Code, Software Testing, Raleigh NC, Durham NC, North Carolina" />
    <meta name="geo.region" content="US-NC" />
    <meta name="geo.placename" content="Raleigh-Durham-Chapel Hill Area" />
    <meta name="geo.position" content="35.7796;-78.6382" />
    <meta name="ICBM" content="35.7796, -78.6382" />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />
    <meta property="og:site_name" content="David Garibay" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={image} />

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

    {breadcrumbSchema && (
      <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
    )}

    <!-- Robots -->
    <meta name="robots" content="index, follow" />
    <meta name="googlebot" content="index, follow" />

    <!-- Preload fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <!-- ui.com-inspired typography system -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />

    <!-- Theme initialization (prevent flash) -->
    <script is:inline>
      // Check for saved theme preference or detect system preference, default to light
      const getTheme = () => {
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
          return localStorage.getItem('theme');
        }
        // Detect system theme preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          return 'dark';
        }
        // Default to light theme like Anthropic
        return 'light';
      };

      const theme = getTheme();
      document.documentElement.setAttribute('data-theme', theme);

      // Listen for system theme changes
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        // Only update if user hasn't set a manual preference
        if (!localStorage.getItem('theme')) {
          const newTheme = e.matches ? 'dark' : 'light';
          document.documentElement.setAttribute('data-theme', newTheme);
        }
      });
    </script>
  </head>
  <body>
    <Header />
    <main id="main-content" class="pt-16">
      <slot />
    </main>
    <Footer />
  </body>
</html>
